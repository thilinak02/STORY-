<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STORY App</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <style>
        :root { --viber: #7360f2; }
        body { font-family: sans-serif; margin: 0; background: #f0f2f5; }
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        .tab-item { flex: 1; padding: 15px; text-align: center; font-weight: bold; cursor: pointer; color: #666; }
        .tab-item.active { color: var(--viber); border-top: 3px solid var(--viber); }
        .page { display: none; padding: 20px; padding-bottom: 80px; }
        .active-page { display: block; }
        .profile-img { width: 80px; height: 80px; border-radius: 50%; background: #ddd; margin: 0 auto 10px; display: block; object-fit: cover; }
        .story-card { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <div id="profile-page" class="page active-page">
        <h2 style="text-align:center;">මගේ ගිණුම</h2>
        <img src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="profile-img" id="user-img">
        <input type="text" id="user-name" placeholder="ඔබේ නම" style="width:100%; padding:10px; margin-bottom:10px;">
        <button onclick="saveProfile()" style="width:100%; padding:10px; background:var(--viber); color:white; border:none; border-radius:10px;">සේව් කරන්න</button>
    </div>

    <div id="story-page" class="page">
        <h2>කෙටි කථා (Stories)</h2>
        <textarea id="story-text" placeholder="ඔබේ කථාව මෙතන ලියන්න..." style="width:100%; height:100px; padding:10px; border-radius:10px;"></textarea>
        <button onclick="postStory()" style="width:100%; padding:10px; background:var(--viber); color:white; border:none; border-radius:10px; margin-top:10px;">Post කරන්න</button>
        <div id="story-list" style="margin-top:20px;"></div>
    </div>

    <div class="tab-bar">
        <div class="tab-item active" onclick="showPage('profile-page', this)">Profile</div>
        <div class="tab-item" onclick="showPage('chat-page', this)">Chats</div>
        <div class="tab-item" onclick="showPage('story-page', this)">Stories</div>
    </div>

    <script>
        // Firebase Config (මම කලින් දීපු එකම මෙතනට දාන්න)
        const firebaseConfig = {
            apiKey: "AIzaSyDJ-9NkKH2GCkkLTr6Xr1Y7rz_bj3qJdF0",
            databaseURL: "https://story-ceca0-default-rtdb.firebaseio.com",
            projectId: "story-ceca0"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function showPage(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(pageId).classList.add('active-page');
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        function postStory() {
            const txt = document.getElementById('story-text').value;
            const user = document.getElementById('user-name').value || "Unknown";
            if(!txt) return;
            db.ref("stories").push({ user: user, text: txt, time: Date.now() });
            document.getElementById('story-text').value = "";
            alert("කථාව පළ කළා!");
        }

        // ලෝඩ් වෙද්දී Stories ටික පෙන්වන්න
        db.ref("stories").on("value", snap => {
            const list = document.getElementById('story-list');
            list.innerHTML = "";
            snap.forEach(s => {
                const d = s.val();
                list.innerHTML += `<div class="story-card"><b>${d.user}</b><p>${d.text}</p></div>`;
            });
        });
    </script>
</body>
</html>
